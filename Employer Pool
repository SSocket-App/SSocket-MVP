// App.js
import React, { useMemo } from "react";
import {
  SafeAreaView,
  StatusBar,
  View,
  Text,
  StyleSheet,
  Platform,
  TouchableOpacity,
  FlatList,
} from "react-native";
import { Ionicons } from "@expo/vector-icons";

const YELLOW = "#FFD54A";
const BLACK = "#000";
const WHITE = "#FFF";

/* --------- Sample Data --------- */
const EMPLOYERS = [
  { name: "Hotel Grand", more: false },
  { name: "Tech Square Ltd", more: false },
  { name: "Blue Ocean Co.", more: true },
];

// Jobs now include poster profile/name
const JOBS = [
  { poster: "Hotel Grand", title: "Hotel Accountant", applicants: "7/13" },
  { poster: "City Cleaners", title: "Company Janitor", applicants: "3/8" },
  { poster: "Sunrise Hotels", title: "Front Desk Officer", applicants: "12/20" },
  { poster: "Ocean View", title: "Kitchen Assistant", applicants: "9/15" },
  { poster: "Fortress Guards", title: "Security Personnel", applicants: "5/10" },
  { poster: "Fresh Laundry Co.", title: "Laundry Supervisor", applicants: "4/9" },
];

export default function App() {
  const ListHeader = useMemo(
    () => (
      <View>
        {EMPLOYERS.map((e, idx) => (
          <EmployerRow key={idx} name={e.name} showMore={e.more} />
        ))}
        <View style={styles.banner}>
          <Text style={styles.bannerText}>Compete & Win Jobs</Text>
          {/* üåü instead of vector icon */}
          <Text style={{ fontSize: 20 }}>üåü</Text>
        </View>
      </View>
    ),
    []
  );

  return (
    <SafeAreaView style={styles.container}>
      <StatusBar barStyle="light-content" backgroundColor={BLACK} />

      {/* Top Bar with search icon */}
      <View style={styles.topBar}>
        <Text style={styles.topBarTitle}>Employer Pool</Text>
        <TouchableOpacity style={styles.searchBtn}>
          <Ionicons name="search-outline" size={24} color={WHITE} />
        </TouchableOpacity>
      </View>
      <View style={styles.topAccent} />

      {/* SCROLLABLE JOB FEED */}
      <FlatList
        data={JOBS}
        keyExtractor={(item, i) => String(i)}
        ListHeaderComponent={ListHeader}
        renderItem={({ item }) => <JobCard job={item} />}
        contentContainerStyle={styles.feedContent}
        showsVerticalScrollIndicator={false}
      />

      {/* Bottom Nav (unchanged) */}
      <View style={styles.bottomBar}>
        <Ionicons name="home-outline" size={28} color={YELLOW} />
        <Ionicons name="briefcase-outline" size={28} color={YELLOW} />
        <Ionicons name="people-outline" size={28} color={YELLOW} />
        <Ionicons name="notifications-outline" size={28} color={YELLOW} />
        <Ionicons name="person-outline" size={28} color={YELLOW} />
      </View>
    </SafeAreaView>
  );
}

/* --------- Components --------- */

function EmployerRow({ name, showMore }) {
  return (
    <View style={styles.row}>
      <View style={styles.avatar}>
        <View style={styles.avatarHead} />
        <View style={styles.avatarBody} />
      </View>

      <View style={{ flex: 1 }}>
        <Text style={styles.name} numberOfLines={1}>
          {name}
        </Text>
        <View style={styles.metaRow}>
          <TouchableOpacity activeOpacity={0.7} style={styles.trackPill}>
            <Text style={styles.trackText}>Track</Text>
          </TouchableOpacity>
        </View>
      </View>

      <View style={{ flexDirection: "row", alignItems: "center", gap: 8 }}>
        <TouchableOpacity activeOpacity={0.7} style={styles.statsBtn}>
          <Text style={styles.statsText}>Stats</Text>
        </TouchableOpacity>
        {showMore && (
          <TouchableOpacity activeOpacity={0.7} style={styles.moreBtn}>
            <Text style={styles.moreText}>More</Text>
          </TouchableOpacity>
        )}
      </View>
    </View>
  );
}

function JobCard({ job }) {
  return (
    <View style={styles.jobCard}>
      {/* NEW: profile + name for this job */}
      <View style={styles.jobHeaderRow}>
        <View style={styles.avatarSmall}>
          <View style={styles.avatarSmallHead} />
          <View style={styles.avatarSmallBody} />
        </View>
        <Text style={styles.jobPoster} numberOfLines={1}>
          {job.poster}
        </Text>
      </View>

      <Text style={styles.jobTitle}>{job.title}</Text>

      {/* 3-column action row */}
      <View style={styles.metricsRow}>
        {/* üåü Competition Button */}
        <TouchableOpacity style={styles.metricCell}>
          <Text style={styles.metricEmoji}>üåü</Text>
          <Text style={styles.metricText}>Compete</Text>
        </TouchableOpacity>

        {/* üìù Role Details Button */}
        <TouchableOpacity style={styles.metricCell}>
          <Text style={styles.metricEmoji}>üìù</Text>
          <Text style={styles.metricText}>Details</Text>
        </TouchableOpacity>

        {/* üë§ Applicants */}
        <View style={styles.metricCell}>
          <Text style={styles.metricEmoji}>üë§</Text>
          <Text style={styles.metricText}>{job.applicants}</Text>
        </View>
      </View>
    </View>
  );
}

/* --------- Styles --------- */
const styles = StyleSheet.create({
  container: { flex: 1, backgroundColor: WHITE },

  topBar: {
    backgroundColor: BLACK,
    height: 88,
    paddingTop: Platform.OS === "android" ? (StatusBar.currentHeight || 0) : 12,
    alignItems: "center",
    justifyContent: "flex-end",
    paddingBottom: 14,
    flexDirection: "row",
    justifyContent: "space-between",
    paddingHorizontal: 16,
  },
  topBarTitle: { color: WHITE, fontSize: 26, fontWeight: "900" },
  searchBtn: { padding: 6 },

  topAccent: { height: 3, backgroundColor: YELLOW },

  feedContent: { paddingBottom: 100 },

  /* employer rows */
  row: {
    flexDirection: "row",
    alignItems: "center",
    paddingHorizontal: 16,
    paddingVertical: 12,
    borderBottomWidth: 1,
    borderBottomColor: "#EFEFEF",
    gap: 12,
  },
  avatar: {
    width: 46,
    height: 46,
    borderRadius: 23,
    borderWidth: 2,
    borderColor: BLACK,
    backgroundColor: WHITE,
    alignItems: "center",
    justifyContent: "center",
  },
  avatarHead: {
    width: 12, height: 12, borderRadius: 6,
    borderWidth: 2, borderColor: BLACK, backgroundColor: WHITE, marginBottom: 1,
  },
  avatarBody: {
    width: 22, height: 10, borderRadius: 6,
    borderWidth: 2, borderColor: BLACK, backgroundColor: WHITE,
  },
  name: { color: BLACK, fontSize: 18, fontWeight: "700", marginBottom: 6 },
  metaRow: { flexDirection: "row", alignItems: "center", gap: 10 },

  trackPill: {
    paddingHorizontal: 12,
    paddingVertical: 5,
    borderRadius: 16,
    borderWidth: 2,
    borderColor: YELLOW,
    backgroundColor: WHITE,
  },
  trackText: { color: BLACK, fontSize: 13, fontWeight: "700" },

  statsBtn: {
    paddingHorizontal: 12,
    paddingVertical: 7,
    borderRadius: 8,
    borderWidth: 2,
    borderColor: BLACK,
    backgroundColor: WHITE,
  },
  statsText: { color: BLACK, fontSize: 14, fontWeight: "800" },

  moreBtn: {
    paddingHorizontal: 10,
    paddingVertical: 7,
    borderRadius: 8,
    borderWidth: 2,
    borderColor: BLACK,
    backgroundColor: WHITE,
  },
  moreText: { color: BLACK, fontSize: 13, fontWeight: "800" },

  /* banner */
  banner: {
    marginTop: 10,
    marginBottom: 6,
    paddingVertical: 12,
    paddingHorizontal: 16,
    borderTopWidth: 1,
    borderBottomWidth: 1,
    borderColor: "#EFEFEF",
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
  },
  bannerText: { fontSize: 18, fontWeight: "800", color: BLACK },

  /* job card */
  jobCard: {
    paddingVertical: 12,
    borderBottomWidth: 1,
    borderBottomColor: "#EFEFEF",
  },

  jobHeaderRow: {
    flexDirection: "row",
    alignItems: "center",
    gap: 10,
    paddingHorizontal: 16,
    paddingBottom: 6,
  },
  avatarSmall: {
    width: 36,
    height: 36,
    borderRadius: 18,
    borderWidth: 2,
    borderColor: BLACK,
    backgroundColor: WHITE,
    alignItems: "center",
    justifyContent: "center",
  },
  avatarSmallHead: {
    width: 10, height: 10, borderRadius: 5,
    borderWidth: 2, borderColor: BLACK, backgroundColor: WHITE, marginBottom: 1,
  },
  avatarSmallBody: {
    width: 16, height: 8, borderRadius: 5,
    borderWidth: 2, borderColor: BLACK, backgroundColor: WHITE,
  },
  jobPoster: { fontSize: 16, fontWeight: "700", color: BLACK },

  jobTitle: {
    fontSize: 20,
    fontWeight: "800",
    color: BLACK,
    paddingHorizontal: 16,
    paddingBottom: 8,
  },

  metricsRow: {
    flexDirection: "row",
    borderTopWidth: 1,
    borderBottomWidth: 1,
    borderColor: "#E6E6E6",
  },
  metricCell: {
    flex: 1,
    alignItems: "center",
    justifyContent: "center",
    paddingVertical: 12,
    borderRightWidth: 1,
    borderColor: "#E6E6E6",
  },
  metricEmoji: { fontSize: 20 },
  metricText: { marginTop: 4, fontWeight: "700", color: BLACK },

  /* bottom nav (unchanged) */
  bottomBar: {
    position: "absolute",
    left: 0, right: 0, bottom: 0,
    height: 64,
    backgroundColor: BLACK,
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-around",
    paddingHorizontal: 12,
  },
});

